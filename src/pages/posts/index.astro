---
import { getPosts, getTopics } from "../../api/github";
import ChevronLeft from "../../icons/chevron-left.astro";
import MainLayout from "../../layouts/Main.astro";

const topic = Astro.url.searchParams.get("topic");

// clean up empty URL param
if (!topic && Astro.url.searchParams.has("topic")) {
  return Astro.redirect("/posts");
}

const [posts, topics] = await Promise.all([
  getPosts(100, { topic }),
  getTopics(),
]);
---

<MainLayout
  title="Oleksandr Sh. content"
  description="Sharing ideas about Software Engineering, Web Development, and Life of an Indie hacker through text, code and memes."
>
  <div class="bg-primary text-on-primary h-[80%] p-8">
    <nav>
      <a
        href="/"
        aria-label="Home page"
        class="outline-on-primary text-on-primary flex flex-row items-center justify-between gap-6 text-2xl font-medium decoration-2 underline-offset-2 outline-2 hover:underline"
      >
        <span>Oleksandr Sh.</span>
        <img
          src="/logo-inner.svg"
          aria-hidden="true"
          class="bg-on-primary h-12 w-12 rounded-2xl p-2"
        />
      </a>
    </nav>
    <div class="pt-4"></div>
    <main>
      <h1 class="mb-8 text-7xl font-bold">Posts</h1>
      <ul
        class="bg-on-background text-background border-stroke/20 rounded-xl border-2 p-4"
      >
        <li><a href="?topic=">All</a></li>
        {
          topics.map((topic) => {
            const name = topic.name.slice(topic.name.indexOf(":") + 1);
            return (
              <li>
                <a href={`?topic=${name}`}>{name}</a>
              </li>
            );
          })
        }
      </ul>
      {
        posts.map((post) => (
          <li>
            <a href={`/posts/${post.number}`}>{post.title}</a>
          </li>
        ))
      }
    </main>
  </div>
</MainLayout>
