---
import { getPostsData } from "../../api/posts";
import Logo from "../../icons/logo.astro";
import MainLayout from "../../layouts/Main.astro";
import { frontmatter } from "../../utils/markdown";

const topic = Astro.url.searchParams.get("topic");

// clean up empty URL param
if (!topic && Astro.url.searchParams.has("topic")) {
  return Astro.redirect("/posts");
}

const { posts, topics } = await getPostsData(100, { topic });
---

<MainLayout
  title="Oleksandr Sh. content"
  description="Sharing ideas about Software Engineering, Web Development, and Life of an Indie hacker through text, code and memes."
>
  <div class="bg-primary text-on-primary h-[80%] p-8">
    <nav>
      <a
        href="/"
        aria-label="Home page"
        class="outline-on-primary text-on-primary flex flex-row items-center justify-between gap-6 text-2xl font-medium decoration-2 underline-offset-2 outline-2 hover:underline"
      >
        <span>Oleksandr Sh.</span>
        <Logo />
      </a>
    </nav>
    <div class="pt-4"></div>
    <main>
      <h1 class="mb-8 text-7xl font-bold">Posts</h1>
      <ul class="text-on-primary flex flex-row gap-2">
        <li
          class="p-2 font-light decoration-2 underline-offset-2 hover:underline"
        >
          <a href="?topic=">All</a>
        </li>
        {
          topics.map((topic) => {
            const name = topic.name.slice(topic.name.indexOf(":") + 1);
            return (
              <li class="p-2 font-light decoration-2 underline-offset-2 hover:underline">
                <a href={`?topic=${name}`}>{name}</a>
              </li>
            );
          })
        }
      </ul>
      {
        posts.map((post) => {
          const data = frontmatter({ body: post.body });
          console.log(data);
          return (
            <li>
              <a href={`/posts/${post.number}`}>{post.title}</a>
            </li>
          );
        })
      }
    </main>
  </div>
</MainLayout>
